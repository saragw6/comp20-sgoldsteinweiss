<!DOCTYPE html>
<html>
	<head>
		<title>MapChat</title>
		<meta name="viewport" content="initial-scale=1.0">
		<meta charset="utf-8">
		<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
		<!-- this might go here: <script src="https://secret-about-box.herokuapp.com/sendLocation"></script> -->
		<link rel="stylesheet" href="style.css">
		<script>
			function init() {
			var map = new google.maps.Map(document.getElementById('map_canvas'), {
	    		center: {lat: 42.4, lng: -71.1},
	    		zoom: 12
	 		});

			if (navigator.geolocation) { // the navigator.geolocation object is supported on your browser
					navigator.geolocation.getCurrentPosition(function(position) {
							//Getting user's location
							myLat = position.coords.latitude;
							myLng = position.coords.longitude;
							
							//Sending user's location, parsing data
							var http = new XMLHttpRequest();
							http.open("POST", "https://secret-about-box.herokuapp.com/sendLocation", true);
							http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
							http.onreadystatechange = function() {if(http.readyState == 4 && http.status == 200) {
								jsondata = http.responseText;
								console.log(jsondata);
								var parsedObjects = JSON.parse(jsondata);

								//setting markers
								for (count = 0; count < parsedObjects.length; count++) {
								var myMarker = new google.maps.Marker({
									position: {lat: parsedObjects[count]["lat"], lng: parsedObjects[count]["lng"]},
 									map: map,
 									icon: "pushpin.png",
	 								title: parsedObjects[count]["login"] + ". " + "[distance]" + " miles away. " + parsedObjects[count]["message"] + "."
								});
								console.log("for function complete");
								}
							}
							};
							http.send("login=TomDapper&lat=" + myLat + "&lng=" + myLng + "&message=Hello");
						});
				}
				else {
					alert("Geolocation is not supported by your web browser.  What a shame!");
				}

			}
		</script>	
	</head>

	<body onload="init()">
		<div id="map_canvas"></div>
	</body>
</html>